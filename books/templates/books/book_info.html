{% extends "books/base.html" %}

{% block content %}

{% load crispy_forms_tags %}

<div class="row" style="margin-bottom: 30px;">
    <div class="col-lg-auto shadow rounded d-flex flex-column justify-content-center align-items-center" style="margin-right: 30px; padding-bottom: 20px;">
        <img src="/media/{{book.image}}" alt="" width="240" height="400" class="shadow-lg" style="max-width: 100%; max-height: 100%; margin-bottom: 20px;">
        <p><b>Rating: {{ book.rating }}/5</b></p>
        <form method="post" action="{% url 'books:rate_book' book.id %}">
            {% csrf_token %}
            <div class="d-flex flex-column justify-content-center align-items-center">
                <div class="form-group col-md-8">
                    <label for="ratingSlider">Rate the book:</label>
                    <input type="range" min="1" max="5" value="3" class="form-range" id="ratingSlider" name="rating">
                </div>
                <button type="submit" class="btn btn-primary" {% if not user.is_authenticated %} disabled {% endif %}>Submit Rating</button>
            </div>
        </form>
    </div>
    <div class="col shadow rounded">
        <h2>{{book.name}}</h2>
        <h4><i>{{book.user.first_name}} {{book.user.last_name}}</i></h4>
        <p>{{book.description}}</p>
        <p>ISBN: {{book.isbn}}</p>
        <p>Date published: {{book.date_pub}}</p>
    </div>
</div>

<div class="container shadow rounded">
<h2 style="text-align: center;"><b>Reviews</b></h2>

<form method="post" action="{% url 'books:book_info' book.id %}">
    {% csrf_token %}
    
    {{form|crispy}}
    
    {% if user.is_authenticated %}
        <div class="container d-grid gap-2 col-3 mx-auto">
            <input type="submit" value="Write a review" class="btn btn-success">
        </div>
    {% else %}
        <div class="container d-grid gap-2 col-3 mx-auto">
            <button type="button" class="btn btn-success" disabled>Write a review</button>
        </div>
    {% endif %}
</form>

<div class="container">
    {% if latest_reviews_list %}
    <div class="d-grid gap-2">
        {% for review in latest_reviews_list %}
            <div class="row">
                <div class="col-2 d-flex flex-column align-items-center justify-content-center">
                    <h5>{{review.user.first_name}} {{review.user.last_name}}</h5>
                    <h6>@{{review.user.username}}</h6>
                </div>
                <div class="col">
                    <p style="text-align: right;">{{review.date_posted}}</p>
                    <p>{{review.text}}</p>
                    {% if review.user == request.user %}
                    <div class="d-flex justify-content-end">
                        <form method="post" action="{% url 'books:delete_review' review.id %}" style="display:inline;">
                            {% csrf_token %}
                            <input type="submit" value="Delete" class="btn btn-danger btn-sm">
                        </form>
                    </div>
                    {% endif %}
                    <hr>
                </div>
            </div>
        {% endfor %}
    </div>
    {% else %}
    <h4>There are no reviews.</h4>
    {% endif %}
</div>
</div>
{% endblock content %}